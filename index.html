<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>極簡健康 | LifeSync</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Varela+Round&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Varela Round"', '"Noto Sans TC"', 'sans-serif'],
                        mono: ['"Varela Round"', 'monospace'],
                    },
                    colors: {
                        dark: {
                            bg: '#09090b',       
                            card: '#18181b',     
                            border: '#27272a',   
                            primary: '#fafafa',  
                            secondary: '#a1a1aa', 
                            accent: '#22c55e',   
                            water: '#3b82f6',    
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        body {
            background-color: #09090b;
            color: #fafafa;
            font-family: 'Varela Round', 'Noto Sans TC', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .chart-scroll-wrapper {
            overflow-x: auto;
            width: 100%;
            -webkit-overflow-scrolling: touch; 
        }

        .chart-container {
            position: relative;
            height: 200px;
            min-width: 100%; 
        }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        .modal-enter-active, .modal-leave-active { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal-enter-from, .modal-leave-to { opacity: 0; transform: scale(0.9); }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden bg-dark-bg text-dark-primary select-none">

    <div id="app" class="h-full flex flex-col relative">

        <!-- Background Glow -->
        <div class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-0">
            <div class="absolute top-[-10%] left-[-10%] w-64 h-64 bg-dark-water/10 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-[-10%] right-[-10%] w-64 h-64 bg-dark-accent/10 rounded-full blur-[100px]"></div>
        </div>

        <!-- Custom Edit Modal -->
        <transition name="modal">
            <div v-if="showEditModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md p-4">
                <div class="bg-dark-card/90 border border-dark-border/50 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative backdrop-blur-xl">
                    <h3 class="text-xl font-bold mb-1 tracking-tight">修改體重</h3>
                    <p class="text-sm text-dark-secondary mb-6 font-mono opacity-80">日期: {{ editingLogDate }}</p>
                    <input type="number" v-model="editWeightInput" 
                        class="w-full bg-black/40 border border-white/10 rounded-2xl p-4 text-3xl text-center font-bold text-white focus:outline-none focus:border-blue-500/50 focus:ring-4 focus:ring-blue-500/10 transition-all mb-6" 
                        placeholder="0.0" autofocus>
                    <div class="flex gap-3">
                        <button @click="showEditModal = false" class="flex-1 py-3.5 rounded-2xl bg-white/5 hover:bg-white/10 text-dark-secondary font-medium transition-colors">取消</button>
                        <button @click="saveEditedWeight" class="flex-1 py-3.5 rounded-2xl bg-white text-black font-bold shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(255,255,255,0.5)] transition-all">確認修改</button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Onboarding Screen -->
        <transition name="fade">
            <div v-if="showOnboarding" class="absolute inset-0 z-50 bg-dark-bg flex flex-col items-center justify-center p-8">
                <div class="w-full max-w-md">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm text-dark-secondary mb-2 font-medium">性別</label>
                            <div class="flex gap-4">
                                <button @click="tempUser.gender = 'male'" :class="tempUser.gender === 'male' ? 'bg-white text-black' : 'bg-dark-card text-gray-400 border border-dark-border'" class="flex-1 py-4 rounded-2xl font-bold transition-all">男性</button>
                                <button @click="tempUser.gender = 'female'" :class="tempUser.gender === 'female' ? 'bg-white text-black' : 'bg-dark-card text-gray-400 border border-dark-border'" class="flex-1 py-4 rounded-2xl font-bold transition-all">女性</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-dark-secondary mb-2 font-medium">年齡</label>
                            <input type="number" v-model="tempUser.age" class="w-full bg-dark-card border border-dark-border rounded-2xl p-4 text-white font-bold focus:outline-none focus:border-white transition-colors" placeholder="請輸入年齡">
                        </div>
                        <div>
                            <label class="block text-sm text-dark-secondary mb-2 font-medium">身高 (cm)</label>
                            <input type="number" v-model="tempUser.height" class="w-full bg-dark-card border border-dark-border rounded-2xl p-4 text-white font-bold focus:outline-none focus:border-white transition-colors" placeholder="請輸入身高">
                        </div>
                    </div>
                    <button @click="completeOnboarding" class="w-full mt-12 bg-white text-black font-bold py-4 rounded-full shadow-[0_0_30px_rgba(255,255,255,0.2)] active:scale-95 transition-all text-lg">開始旅程</button>
                </div>
            </div>
        </transition>

        <!-- Main Content -->
        <div v-if="!showOnboarding" class="flex-1 flex flex-col z-10 overflow-hidden">
            
            <header class="px-6 pt-12 pb-4 flex justify-between items-center bg-dark-bg/80 backdrop-blur-xl sticky top-0 z-20 h-[88px] border-b border-white/5">
                <div v-if="currentTab === 'stats'">
                    <!-- Removed title as requested previously -->
                </div>
                <div v-else></div>
                <div @click="currentTab = 'settings'" class="p-2.5 bg-dark-card/50 hover:bg-dark-card rounded-full border border-dark-border cursor-pointer active:scale-90 transition-all">
                    <i class="ph ph-gear text-xl text-gray-300"></i>
                </div>
            </header>

            <main class="flex-1 overflow-hidden relative">
                
                <!-- Tab 1: Stats & Water -->
                <div v-show="currentTab === 'stats'" class="h-full overflow-y-auto no-scrollbar px-6 pb-32 animate-fade-in space-y-6">
                    
                    <!-- Water Tracker Card (Moved Here) -->
                    <div class="bg-dark-card border border-dark-border rounded-[2rem] p-6 shadow-2xl mt-6 relative overflow-hidden">
                        <div class="absolute -left-10 -top-10 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
                        
                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <div>
                                <label class="text-sm text-dark-secondary font-medium block mb-1">今日水量</label>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-4xl font-bold font-mono text-blue-400">{{ waterData.todayTotal }}</span>
                                    <span class="text-sm text-dark-secondary font-mono">/ {{ waterData.dailyGoal }}ml</span>
                                </div>
                            </div>
                            <div class="bg-dark-bg/50 border border-white/5 rounded-xl px-3 py-2 text-right">
                                <p class="text-[10px] text-dark-secondary uppercase">連續達成</p>
                                <p class="text-lg font-bold text-white font-mono">{{ waterData.streak }} <span class="text-xs text-dark-secondary font-sans">天</span></p>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="w-full bg-dark-bg h-2 rounded-full overflow-hidden mb-5">
                            <div class="bg-blue-500 h-full transition-all duration-1000 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]" :style="{ width: getProgressPercent + '%' }"></div>
                        </div>

                        <!-- Water Buttons -->
                        <div class="flex gap-3 relative z-10">
                            <button v-for="(amount, index) in waterData.buttons" :key="index" @click="addWater(amount)" 
                                class="flex-1 flex flex-col items-center justify-center bg-dark-bg border border-dark-border hover:border-blue-500/50 py-3 rounded-2xl active:bg-blue-500 active:text-white transition-all group">
                                <i class="ph-fill ph-drop text-blue-400 text-lg group-active:text-white mb-1"></i>
                                <span class="font-mono text-xs font-bold text-gray-300 group-active:text-white">{{ amount }}ml</span>
                            </button>
                        </div>
                    </div>

                    <!-- Weight Input Card -->
                    <div class="bg-dark-card border border-dark-border rounded-[2rem] p-6 shadow-2xl relative overflow-hidden">
                        <div class="absolute -right-10 -top-10 w-32 h-32 bg-green-500/5 rounded-full blur-3xl pointer-events-none"></div>
                        
                        <div class="flex justify-between items-end mb-4 relative z-10">
                            <label class="text-sm text-dark-secondary font-medium">今日體重記錄</label>
                            <span class="text-sm text-dark-accent font-mono font-bold bg-dark-accent/10 px-2 py-1 rounded-lg" v-if="bmiDisplay">BMI: {{ bmiDisplay }}</span>
                        </div>
                        <div class="flex gap-3 relative z-10">
                            <input type="number" v-model="newWeight" placeholder="0.0" class="flex-1 min-w-0 bg-dark-bg rounded-2xl px-4 py-4 text-3xl font-bold text-center focus:outline-none focus:ring-2 focus:ring-dark-secondary/50 placeholder-gray-700">
                            <button @click="addWeightLog" class="shrink-0 bg-white text-black px-8 rounded-2xl font-bold text-lg active:scale-95 transition-transform shadow-lg hover:shadow-white/20">記錄</button>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="space-y-6">
                        <div class="bg-dark-card border border-dark-border rounded-[2rem] p-6 shadow-lg">
                            <h3 class="text-sm text-dark-secondary mb-4 flex items-center gap-2 font-bold tracking-wide uppercase"><i class="ph-fill ph-trend-up text-dark-accent text-lg"></i> 體重</h3>
                            <div class="chart-scroll-wrapper no-scrollbar">
                                <div class="chart-container" :style="{ width: chartWidth }"><canvas id="weightChart"></canvas></div>
                            </div>
                        </div>
                        <div class="bg-dark-card border border-dark-border rounded-[2rem] p-6 relative shadow-lg">
                            <h3 class="text-sm text-dark-secondary mb-8 flex items-center gap-2 font-bold tracking-wide uppercase"><i class="ph-fill ph-heartbeat text-blue-400 text-lg"></i> BMI</h3>
                            <div class="absolute top-6 right-6 grid grid-cols-2 sm:grid-cols-3 gap-x-3 gap-y-1.5 text-[10px] text-zinc-500 font-medium">
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#22c55e] shadow-[0_0_5px_#22c55e]"></span>&lt;18.5</div>
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#3b82f6] shadow-[0_0_5px_#3b82f6]"></span>18.5-24</div>
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#eab308]"></span>24-27</div>
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#f97316]"></span>27-30</div>
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#ef4444]"></span>30-35</div>
                                 <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-[#a855f7]"></span>&ge;35</div>
                            </div>
                            <div class="chart-scroll-wrapper no-scrollbar">
                                <div class="chart-container" :style="{ width: chartWidth }"><canvas id="bmiChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Settings -->
                <div v-show="currentTab === 'settings'" class="h-full overflow-y-auto no-scrollbar px-6 pb-32 space-y-6">
                    <div class="bg-dark-card border border-dark-border rounded-3xl p-6 mt-4">
                        <h3 class="text-lg font-bold mb-4 border-b border-dark-border pb-2">個人檔案</h3>
                        <div class="space-y-4">
                            <div><label class="text-xs text-dark-secondary">身高 (cm)</label><input type="number" v-model="user.height" @change="saveData" class="w-full bg-dark-bg p-3 rounded-xl border border-dark-border mt-1"></div>
                            <div><label class="text-xs text-dark-secondary">年齡</label><input type="number" v-model="user.age" @change="saveData" class="w-full bg-dark-bg p-3 rounded-xl border border-dark-border mt-1"></div>
                            <div><label class="text-xs text-dark-secondary">性別</label><select v-model="user.gender" @change="saveData" class="w-full bg-dark-bg p-3 rounded-xl border border-dark-border mt-1 text-white"><option value="male">男性</option><option value="female">女性</option></select></div>
                        </div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-3xl p-6">
                        <h3 class="text-lg font-bold mb-4 border-b border-dark-border pb-2">水杯設定</h3>
                        <div class="grid grid-cols-3 gap-3">
                            <div v-for="(btn, idx) in waterData.buttons" :key="idx"><label class="text-xs text-dark-secondary">按鈕 {{idx+1}}</label><input type="number" v-model="waterData.buttons[idx]" @change="saveData" class="w-full bg-dark-bg p-2 text-center rounded-xl border border-dark-border mt-1 font-mono text-sm"></div>
                        </div>
                    </div>
                    <button @click="resetAllData" class="w-full py-4 text-red-500 text-sm font-medium opacity-60 hover:opacity-100">重置所有數據</button>
                </div>
            </main>

            <nav class="bg-dark-card/90 backdrop-blur-xl border-t border-dark-border/50 pb-safe pt-2 px-6 flex justify-around items-center h-[80px] z-30 fixed bottom-0 w-full">
                <button @click="currentTab = 'stats'" :class="currentTab === 'stats' ? 'text-white' : 'text-dark-secondary'" class="flex flex-col items-center gap-1 w-24 group">
                    <i :class="currentTab === 'stats' ? 'ph-fill' : 'ph'" class="ph-chart-bar text-2xl group-active:scale-95 transition-transform"></i>
                    <span class="text-[10px] font-medium font-sans">數據</span>
                </button>
                <!-- Removed Water Tab -->
                <button @click="currentTab = 'settings'" :class="currentTab === 'settings' ? 'text-white' : 'text-dark-secondary'" class="flex flex-col items-center gap-1 w-24 group">
                    <i :class="currentTab === 'settings' ? 'ph-fill' : 'ph'" class="ph-user text-2xl group-active:scale-95 transition-transform"></i>
                    <span class="text-[10px] font-medium font-sans">設定</span>
                </button>
            </nav>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, reactive, onUnmounted } = Vue;

        createApp({
            setup() {
                const showOnboarding = ref(true);
                const currentTab = ref('stats');
                const newWeight = ref('');
                const showEditModal = ref(false);
                const editWeightInput = ref('');
                const editingLogIndex = ref(-1);

                let weightChartInstance = null;
                let bmiChartInstance = null;
                const user = reactive({ gender: 'male', age: 25, height: 170 });
                const tempUser = reactive({...user});
                const weightLogs = ref([]); 
                
                const waterData = reactive({
                    todayTotal: 0,
                    lastDate: new Date().toDateString(),
                    streak: 0,
                    lastGoalDate: null, 
                    buttons: [150, 300, 500],
                    petCount: 0, // Kept for data structure compatibility but unused visually
                    dailyGoal: 3000
                });

                const chartWidth = computed(() => {
                    const count = weightLogs.value.length;
                    if (count <= 7) return '100%';
                    return Math.max(window.innerWidth - 80, count * 50) + 'px';
                });

                const editingLogDate = computed(() => {
                    if (editingLogIndex.value >= 0 && weightLogs.value[editingLogIndex.value]) return weightLogs.value[editingLogIndex.value].date;
                    return '';
                });

                const getBmiColor = (bmi) => {
                    if (bmi < 18.5) return '#22c55e';
                    if (bmi < 24) return '#3b82f6';
                    if (bmi < 27) return '#eab308';
                    if (bmi < 30) return '#f97316';
                    if (bmi < 35) return '#ef4444';
                    return '#a855f7';
                };

                // Water progress
                const getProgressPercent = computed(() => {
                    const percentage = (waterData.todayTotal / waterData.dailyGoal) * 100;
                    return Math.min(percentage, 100);
                });

                const bmiDisplay = computed(() => weightLogs.value.length ? weightLogs.value[weightLogs.value.length - 1].bmi : null);

                const loadData = () => {
                    const savedUser = localStorage.getItem('ls_user');
                    const savedLogs = localStorage.getItem('ls_logs');
                    const savedWater = localStorage.getItem('ls_water');

                    if (savedUser) { Object.assign(user, JSON.parse(savedUser)); showOnboarding.value = false; }
                    if (savedLogs) weightLogs.value = JSON.parse(savedLogs);
                    if (savedWater) {
                        const parsed = JSON.parse(savedWater);
                        Object.assign(waterData, parsed);
                        waterData.dailyGoal = 3000; 
                        const todayStr = new Date().toDateString();
                        if (waterData.lastDate !== todayStr) {
                            const yesterday = new Date();
                            yesterday.setDate(yesterday.getDate() - 1);
                            const yesterdayStr = yesterday.toDateString();
                            if (waterData.streak > 0 && waterData.lastGoalDate !== yesterdayStr && waterData.lastGoalDate !== todayStr) {
                                waterData.streak = 0;
                            }
                            waterData.todayTotal = 0;
                            waterData.lastDate = todayStr;
                            saveData();
                        }
                    }
                };

                const saveData = () => {
                    localStorage.setItem('ls_user', JSON.stringify(user));
                    localStorage.setItem('ls_logs', JSON.stringify(weightLogs.value));
                    localStorage.setItem('ls_water', JSON.stringify(waterData));
                };

                const completeOnboarding = () => {
                    if(!tempUser.height || !tempUser.age) return alert('請填寫完整資訊');
                    Object.assign(user, tempUser);
                    showOnboarding.value = false;
                    saveData();
                    setTimeout(initCharts, 100);
                };

                const calcBmi = (w, h) => {
                    const h_m = h / 100;
                    return (w / (h_m * h_m)).toFixed(1);
                }

                const addWeightLog = () => {
                    if (!newWeight.value) return;
                    const w = parseFloat(newWeight.value);
                    const bmi = calcBmi(w, user.height);
                    const todayStr = new Date().toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit' });
                    const lastLog = weightLogs.value[weightLogs.value.length - 1];
                    if (lastLog && lastLog.date === todayStr) { lastLog.weight = w; lastLog.bmi = bmi; } 
                    else { weightLogs.value.push({ date: todayStr, weight: w, bmi: bmi }); }
                    newWeight.value = '';
                    saveData();
                    updateCharts();
                };

                const openEditModal = (index) => {
                    if (index < 0 || index >= weightLogs.value.length) return;
                    editingLogIndex.value = index;
                    editWeightInput.value = weightLogs.value[index].weight;
                    showEditModal.value = true;
                };

                const saveEditedWeight = () => {
                    if (editingLogIndex.value >= 0 && editWeightInput.value) {
                        const w = parseFloat(editWeightInput.value);
                        weightLogs.value[editingLogIndex.value].weight = w;
                        weightLogs.value[editingLogIndex.value].bmi = calcBmi(w, user.height);
                        saveData();
                        updateCharts();
                        showEditModal.value = false;
                    }
                };

                const addWater = (amount) => {
                    const wasGoalMet = waterData.todayTotal >= waterData.dailyGoal;
                    waterData.todayTotal += amount;
                    const isGoalMet = waterData.todayTotal >= waterData.dailyGoal;
                    
                    if (!wasGoalMet && isGoalMet) {
                        const todayStr = new Date().toDateString();
                        if (waterData.lastGoalDate !== todayStr) {
                            waterData.streak++;
                            waterData.lastGoalDate = todayStr;
                        }
                    }
                    saveData();
                };

                const resetAllData = () => {
                    if(confirm('確定要刪除所有資料並重置嗎？')) { localStorage.clear(); location.reload(); }
                };

                const initCharts = () => {
                    if (currentTab.value !== 'stats') return;
                    const ctxW = document.getElementById('weightChart');
                    const ctxB = document.getElementById('bmiChart');
                    if (!ctxW || !ctxB) return;
                    
                    const gradientFill = ctxW.getContext('2d').createLinearGradient(0, 0, 0, 200);
                    gradientFill.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
                    gradientFill.addColorStop(1, 'rgba(255, 255, 255, 0)');

                    const bmiGradient = ctxB.getContext('2d').createLinearGradient(0, 0, 0, 200);
                    bmiGradient.addColorStop(0, 'rgba(59, 130, 246, 0.2)');
                    bmiGradient.addColorStop(1, 'rgba(59, 130, 246, 0)');

                    const commonOptions = {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false }, ticks: { color: '#71717a', font: { family: "'Varela Round', sans-serif" } } }, y: { grid: { color: '#27272a' }, ticks: { color: '#71717a', font: { family: "'Varela Round', sans-serif" } } } },
                        elements: { line: { tension: 0.4 }, point: { radius: 6, hitRadius: 20, hoverRadius: 8, borderWidth: 2 } },
                        onClick: (e, elements) => {
                            if (elements && elements.length > 0) openEditModal(elements[0].index);
                        }
                    };
                    if (weightChartInstance) weightChartInstance.destroy();
                    if (bmiChartInstance) bmiChartInstance.destroy();
                    weightChartInstance = new Chart(ctxW, { type: 'line', data: { labels: weightLogs.value.map(l => l.date), datasets: [{ data: weightLogs.value.map(l => l.weight), borderColor: '#ffffff', backgroundColor: gradientFill, fill: true, borderWidth: 3, pointBackgroundColor: '#18181b', pointBorderColor: '#fff' }] }, options: commonOptions });
                    bmiChartInstance = new Chart(ctxB, { 
                        type: 'line', 
                        data: { 
                            labels: weightLogs.value.map(l => l.date), 
                            datasets: [{ 
                                data: weightLogs.value.map(l => l.bmi), 
                                borderColor: '#3b82f6', 
                                backgroundColor: bmiGradient, 
                                fill: true, 
                                borderWidth: 3,
                                pointBackgroundColor: weightLogs.value.map(l => getBmiColor(l.bmi)),
                                pointBorderColor: '#18181b'
                            }] 
                        }, 
                        options: commonOptions 
                    });
                };

                const updateCharts = () => {
                    if (currentTab.value !== 'stats') return;
                    if (!weightChartInstance) { initCharts(); return; }
                    const labels = weightLogs.value.map(l => l.date);
                    weightChartInstance.data.labels = labels;
                    weightChartInstance.data.datasets[0].data = weightLogs.value.map(l => l.weight);
                    weightChartInstance.update();
                    bmiChartInstance.data.labels = labels;
                    bmiChartInstance.data.datasets[0].data = weightLogs.value.map(l => l.bmi);
                    bmiChartInstance.data.datasets[0].pointBackgroundColor = weightLogs.value.map(l => getBmiColor(l.bmi));
                    bmiChartInstance.data.datasets[0].pointBorderColor = weightLogs.value.map(l => getBmiColor(l.bmi));
                    bmiChartInstance.update();
                };

                watch(currentTab, (newVal) => {
                    if (newVal === 'stats') { setTimeout(initCharts, 50); }
                });

                onMounted(() => {
                    loadData();
                    if (!showOnboarding.value) {
                         if (currentTab.value === 'stats') setTimeout(initCharts, 100);
                    }
                });

                return {
                    showOnboarding, currentTab, user, tempUser, completeOnboarding, newWeight, addWeightLog, bmiDisplay, waterData, addWater,
                    saveData, resetAllData, getProgressPercent,
                    showEditModal, editWeightInput, saveEditedWeight, editingLogDate, chartWidth
                };
            }
        }).mount('#app');
    </script>
</body>
</html>